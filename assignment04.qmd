---
title: "Assignment 4"
author: "Kelly Primrose and Diana Schoder"
format: html
editor: visual
warning: false
---

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(sf)
library(tigris)
library(dplyr)
library(forcats)
```

## Graph One

[Capital Bikeshare data](https://capitalbikeshare.com/system-data) shows that both casual users and members began their trips throughout the Capital Bikeshare system in January 2023, including in DC, Maryland, and Virginia.

```{r}

#Read in Capital Bikeshare data
cabi <- read.csv(file = '202301-capitalbikeshare-tripdata.csv')

start_station <- st_as_sf(cabi, coords = c("start_lng", "start_lat")) %>% 
st_set_crs(value = 4326)

dc <- states(progress_bar = FALSE) %>%
 filter(STUSPS == "DC") 

md <- counties("MD", progress_bar = FALSE) %>%
  filter(COUNTYFP == "031" | COUNTYFP == "033") 

va <- counties("VA", progress_bar = FALSE) %>%
  filter(COUNTYFP == "013" |COUNTYFP == "059" | COUNTYFP == "510")  

ggplot() +
  geom_sf(data = dc) +
   geom_sf(data = md) +
   geom_sf(data = va) +
  geom_sf(data = start_station,
          aes(color = member_casual)) +
   labs(title = "Member and Casual Trips in January 2023", subtitle = "Capital Bikeshare Starting Stations", caption = "Data Source: Capital Bikeshare", fill = "User Types") +
  theme_void()



```

## Total Bikeshare Trips by Day of the Week

According to [Capital Bikeshare data](https://capitalbikeshare.com/system-data), the total bikeshare trips in January 2023 were highest on Mondays and Tuesdays, and similar all other days of the week.

```{r}
# Put end time variable into date format and extract day of the week
end_time <- ymd_hms(cabi$ended_at)
day <- wday(end_time)


# Graph Total Bikeshare Trips by Day of the Week
cabi %>% 
   ggplot() +
   geom_bar(mapping = aes(x = day)) +
   labs(title = "Total Bikeshare Trips by Day of the Week", subtitle = "Capital Bikeshare, January 2023", caption = "Data Source: Capital Bikeshare") +
  xlab("Day of the Week") +
  ylab("Total Trips in January") +
  scale_x_discrete(limit = c(1, 2, 3, 4, 5, 6, 7), 
                   labels = c("Sunday","Monday","Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))



```

## Graph Three: Top 10 Most Popular Destination Stations

```{r}

#replacing empty instances of end_station_name with "Abandoned bike", as these unreturned bikes were likely left somewhere.

cabi <- cabi%>%
  mutate(end_station_name = ifelse(end_station_name == "", "Abandoned bike", end_station_name))

#grouping by end station and counting in descending order to see which stations are most popular destinations
cabi%>%
  group_by(end_station_name)%>%
  summarize(count = n())%>%
  arrange(desc(count))%>%
  filter(count > 1630)%>%
  ggplot() +
  geom_count(mapping = aes(x=end_station_name, y = count))+
  labs(title = "Top 10 Destinations By Rider End Points",
       subtitle = "Unreturned Bikes Lead Over Any Destination", 
       caption = "Data source: Capitol Bikeshare Trip History Data",
       n = "Riders Who Stopped at this Destination")+
  ylab("Count")
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

ggsave(filename = "populardests.png")
ungroup()
```
## Graph Four: Trip Duration by Members Versus Casual Riders*

```{r}
#I'm creating a variable for ride duration so I can compare duration for members vs casuals
cabi <- cabi%>%
  mutate(duration = as.numeric(difftime(end_time, start_time, units = "mins")))



cabi%>%
  ggplot(aes(x=duration, fill = member_casual)) +
  geom_area(stat = "bin", bins = 10)+
  geom_vline(xintercept = mean(cabi$duration, na.rm = TRUE), color = 'gray', lty = 'dashed', lwd = 1)+
  theme_classic()+
  xlim(0, 250)


```